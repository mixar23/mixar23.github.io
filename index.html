<!DOCTYPE html>
<html lang="en">
<head>
<style src = 'main.css'></style>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css">
</head>

<body>
    <div class="container">
        <a class="navbar-brand">Просто</a>
        <a class="navbar-brand">Главная</a>
    </div>
        <div class = 'desk'>
            <p><img src= 'png/desk.png' alt="chess_desk" id = "chess_desk" widht = 496 height = 492/></p>
        </div>  

            <img src=  'png/w_figures/chess.1.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_1"/> 
            <img src=  'png/w_figures/chess.2.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_2"/>
            <img src=  'png/w_figures/chess.3.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_3"/>
            <img src=  'png/w_figures/chess.4.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_4"/>
            <img src=  'png/w_figures/chess.5.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_5"/>
            <img src=  'png/w_figures/chess.6.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_6"/>
            <img src=  'png/w_figures/chess.6.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_7"/>
            <img src=  'png/w_figures/chess.6.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_8"/>
            <img src=  'png/w_figures/chess.6.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_9"/>
            <img src=  'png/w_figures/chess.6.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_10"/>
            <img src=  'png/w_figures/chess.6.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_11"/>
            <img src=  'png/w_figures/chess.6.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_12"/>
            <img src=  'png/w_figures/chess.6.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_13"/>
            <img src=  'png/w_figures/chess.5.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_14"/>
            <img src=  'png/w_figures/chess.2.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_15"/>
            <img src=  'png/w_figures/chess.4.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_16"/>
           
           

            <img src=  'png/b_figures/chess.1.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_1_b"/> 
            <img src=  'png/b_figures/chess.2.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_2_b"/>
            <img src=  'png/b_figures/chess.3.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_3_b"/>
            <img src=  'png/b_figures/chess.4.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_4_b"/>
            <img src=  'png/b_figures/chess.5.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_5_b"/>
            <img src=  'png/b_figures/chess.6.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_6_b"/>
            <img src=  'png/b_figures/chess.6.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_7_b"/>
            <img src=  'png/b_figures/chess.6.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_8_b"/>
            <img src=  'png/b_figures/chess.6.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_9_b"/>
            <img src=  'png/b_figures/chess.6.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_10_b"/>
            <img src=  'png/b_figures/chess.6.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_11_b"/>
            <img src=  'png/b_figures/chess.6.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_12_b"/>
            <img src=  'png/b_figures/chess.6.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_13_b"/>
            <img src=  'png/b_figures/chess.5.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_14_b"/>
            <img src=  'png/b_figures/chess.2.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_15_b"/>
            <img src=  'png/b_figures/chess.4.png' width = 55 height = 55 alt="chess_figure" id = "chess_figure_16_b"/>
            
    
    
            <script type = 'text/javascript' src = "js/move.js">
                
            </script>
    
            <script type="text/javascript">

                var elements = [];
                //base_desk:
                var bd = [[4,3,2,5,6,2,3,4],[1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[7,7,7,7,7,7,7,7],[10,9,8,11,12,8,9,10]];
                var ids = ['chess_figure_1','chess_figure_2','chess_figure_3','chess_figure_4','chess_figure_5','chess_figure_6','chess_figure_7','chess_figure_8','chess_figure_9','chess_figure_10','chess_figure_11','chess_figure_12','chess_figure_13','chess_figure_14','chess_figure_15','chess_figure_16','chess_figure_1_b','chess_figure_2_b','chess_figure_3_b','chess_figure_4_b','chess_figure_5_b','chess_figure_6_b','chess_figure_7_b','chess_figure_8_b','chess_figure_9_b','chess_figure_10_b','chess_figure_11_b','chess_figure_12_b','chess_figure_13_b','chess_figure_14_b','chess_figure_15_b','chess_figure_16_b'];
                
                // где физически находятся id фигур
                var id_place = [["chess_figure_5_b","chess_figure_4_b","chess_figure_2_b","chess_figure_3_b","chess_figure_1_b","chess_figure_15_b","chess_figure_16_b","chess_figure_14_b"],["chess_figure_6_b","chess_figure_7_b","chess_figure_8_b","chess_figure_9_b","chess_figure_10_b","chess_figure_11_b","chess_figure_12_b","chess_figure_13_b"],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],["chess_figure_6","chess_figure_7","chess_figure_8","chess_figure_9","chess_figure_10","chess_figure_11","chess_figure_12","chess_figure_13"],["chess_figure_5","chess_figure_4","chess_figure_2","chess_figure_3","chess_figure_1","chess_figure_15","chess_figure_16","chess_figure_14"]];
    
                for (let i = 0;i < 32;i++){
                    
                    elements[i] = document.getElementById(ids[i]);
                    elements[i].onmousedown = function(e) {
    
                        //определим координаты квадрата начала движения
                        var y0_coord = div((div((e.pageX - elements[i].offsetWidth / 2) + 6,55) * 55 + 22-461),55);
                        var x0_coord = div((div((e.pageY - elements[i].offsetHeight / 2) + 32,55) * 55 - 4 - 101),55);
                        console.log('координаты начала: ',x0_coord,y0_coord);
    
                        elements[i].style.position = 'absolute';
                        var first_coorx = div((e.pageX - elements[i].offsetWidth / 2) + 6,55) * 55 + 22 + 'px';
                        var first_coory = div((e.pageY - elements[i].offsetHeight / 2) + 32,55) * 55 - 4 + 'px';
                        console.log(first_coorx,first_coory);
                        moveAt(e);
                        document.body.appendChild(elements[i]);
                        elements[i].style.zIndex = 1000;
                        function moveAt(e) {
                            elements[i].style.left = e.pageX - elements[i].offsetWidth / 2 + 'px';
                            elements[i].style.top = e.pageY - elements[i].offsetHeight / 2 + 'px';
                        }
                        function div(val, by){
                                return (val - val % by) / by;
                            }
                            //выравнивание по квадрату
                        function moveTo(e) {
                            elements[i].style.left = div((e.pageX - elements[i].offsetWidth / 2) + 6,55) * 55 + 22 + 'px';
                            elements[i].style.top = div((e.pageY - elements[i].offsetHeight / 2) + 32,55) * 55 - 4 + 'px';
                        }
                        document.onmousemove = function(e) {
                            moveAt(e);
                        }
                        elements[i].onmouseup = function(e) {
                            document.onmousemove = null;

                            elements[i].onmouseup = null;
                            //определим координаты квадрата окончания движения
                            var y_coord = div((div((e.pageX - elements[i].offsetWidth / 2) + 6,55) * 55 + 22-461),55);
                            var x_coord = div((div((e.pageY - elements[i].offsetHeight / 2) + 32,55) * 55 - 4 - 101),55);
                            console.log('координаты конца: ',x_coord,y_coord,bd);
    
    
                            //проверка что конечные координаты находятся на доске
                            if (div((e.pageX - elements[i].offsetWidth / 2) + 6,55) * 55 + 22 > 901){
                                elements[i].style.left = first_coorx;
                                elements[i].style.top = first_coory;
    
                            }else if(div((e.pageX - elements[i].offsetWidth / 2) + 6,55) * 55 + 22 < 461){
                                elements[i].style.left = first_coorx;
                                elements[i].style.top = first_coory;
    
                            }else if(div((e.pageY - elements[i].offsetHeight / 2) + 32,55) * 55 - 4 > 500){
                                elements[i].style.left = first_coorx;
                                elements[i].style.top = first_coory;
    
                            }else if(div((e.pageY - elements[i].offsetHeight / 2) + 32,55) * 55 - 4 < 100){
                                elements[i].style.left = first_coorx;
                                elements[i].style.top = first_coory;
                            
                            //ready block
                            }else if (bd[x_coord][y_coord] == 0){// если поле пустое то передвигаем элементы в матрице и на доске
                                console.log(is_figure_on_line(5,3,6,3,[[4,3,2,5,6,2,3,4],[1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[7,7,7,7,7,7,7,7],[10,9,8,11,12,8,9,10]]))
                                steps = can_move_to(x0_coord,y0_coord,bd[x0_coord][y0_coord]);
                                if(steps[x_coord][y_coord] == 1){
                                    //если ладья проверяем нет на линиях лишних фигур
                                    if((bd[x0_coord][y0_coord]  % 6 == 4)){
                                        console.log('это ладья');
                                        if(is_figure_on_line(x_coord,y_coord,x0_coord,y0_coord,bd) == true){
                                            moveTo(e);
                                            bd = changepos(x0_coord,y0_coord,x_coord,y_coord,bd);
                                            id_place = changepos(x0_coord,y0_coord,x_coord,y_coord,id_place);
                                            console.log('uspeh@!!!@');
                                        }else{
                                            elements[i].style.left = first_coorx;
                                            elements[i].style.top = first_coory;
                                        }                                
                                    }else if((bd[x0_coord][y0_coord]  % 6 == 2)){
                                        console.log('это слон');
                                        if(is_figure_on_line(x_coord,y_coord,x0_coord,y0_coord,bd) == true){
                                            moveTo(e);
                                            bd = changepos(x0_coord,y0_coord,x_coord,y_coord,bd);
                                            id_place = changepos(x0_coord,y0_coord,x_coord,y_coord,id_place);
                                            console.log('uspeh@!!!@'); 
                                        }else{
                                            elements[i].style.left = first_coorx;
                                            elements[i].style.top = first_coory;
                                        } 

                                    }else if((bd[x0_coord][y0_coord]  % 6 == 5)){
                                        console.log('это ферзь');
                                        if ((is_figure_on_line(x_coord,y_coord,x0_coord,y0_coord,bd)) == true){
                                            console.log('hello')
                                            moveTo(e);
                                            bd = changepos(x0_coord,y0_coord,x_coord,y_coord,bd);
                                            id_place = changepos(x0_coord,y0_coord,x_coord,y_coord,id_place);
                                            console.log('uspeh@!!!@'); 
                                        }else{
                                            elements[i].style.left = first_coorx;
                                            elements[i].style.top = first_coory;
                                        }
                                        //белая пешка
                                    }else if (bd[x0_coord][y0_coord] == 7){
                                        console.log(bd,x_coord,y_coord,x0_coord,y0_coord,is_figure_on_line,'///////////////');
                        
                                        if ((bd[x0_coord-1][y0_coord] != 0)||(y0_coord != y_coord)){
                                            elements[i].style.left = first_coorx;
                                            elements[i].style.top = first_coory;
                                        }else{
                                            moveTo(e);
                                            bd = changepos(x0_coord,y0_coord,x_coord,y_coord,bd);
                                            id_place = changepos(x0_coord,y0_coord,x_coord,y_coord,id_place);

                                        }
                                        //черная пешка
                                    }else if (bd[x0_coord][y0_coord] == 1){
                                        console.log(bd,x_coord,y_coord,x0_coord,y0_coord,is_figure_on_line,'///////////////');
                        
                                        if ((bd[x0_coord+1][y0_coord] != 0)||(y0_coord != y_coord)){
                                            elements[i].style.left = first_coorx;
                                            elements[i].style.top = first_coory;
                                        }else{
                                            moveTo(e);
                                            bd = changepos(x0_coord,y0_coord,x_coord,y_coord,bd);
                                            id_place = changepos(x0_coord,y0_coord,x_coord,y_coord,id_place);

                                        }
                                    }else if ((bd[x0_coord][y0_coord] % 6 == 3)||(bd[x0_coord][y0_coord] % 6 == 0)){
                                        console.log('конь or король');
                                        moveTo(e);
                                        bd = changepos(x0_coord,y0_coord,x_coord,y_coord,bd);
                                        id_place = changepos(x0_coord,y0_coord,x_coord,y_coord,id_place);
                                    }
                                }else{
                                    console.log('ggg');
                                    elements[i].style.left = first_coorx;
                                    elements[i].style.top = first_coory;
                                }
                                
                            }else{
                            //ready block end  
                                // если что-то стоит уже на этом месте проверяем другой ли это цвет фигуры возвращаем на исходное положение
                                steps = can_move_to(x0_coord,y0_coord,bd[x0_coord][y0_coord]);
                                if (steps[x_coord][y_coord] == 1){
                                    if ((div(bd[x_coord][y_coord],7) - div(bd[x0_coord][y0_coord],7)) != 0){
                                        if (bd[x0_coord][y0_coord] % 6 == 4){
                                            //проверяем может ли эту фигуру съесть ладья

                                            console.log('this is ladya',x_coord,y_coord,x0_coord,y0_coord,bd,(is_figure_on_line(x_coord,y_coord,x0_coord,y0_coord,bd)));
                                            if (is_figure_on_line(x_coord,y_coord,x0_coord,y0_coord,bd) == true){
                                                //съедаем фигуру  и занимаем ее место
                                                var id_down_fig = id_place[x_coord][y_coord];
                                                fig = document.getElementById(id_down_fig);
                                                fig.parentNode.removeChild(fig);
                                                bd = changepos(x0_coord,y0_coord,x_coord,y_coord,bd);
                                                id_place = changepos(x0_coord,y0_coord,x_coord,y_coord,id_place);
                                                id_place[x0_coord][y0_coord] = 0;
                                                bd[x0_coord][y0_coord] = 0;
                                                moveTo(e)
                                            }else{
                                                console.log('tut');
                                                elements[i].style.left = first_coorx;
                                                elements[i].style.top = first_coory;
                                            }
                                        }else if (bd[x0_coord][y0_coord] % 6 == 2){
                                            //проверяем может ли эту фигуру съесть слон
                                            console.log('this is slon');
                                            if (is_figure_on_line(x_coord,y_coord,x0_coord,y0_coord,bd)){
                                                //съедаем фигуру и занимаем ее место
                                                var id_down_fig = id_place[x_coord][y_coord];
                                                fig = document.getElementById(id_down_fig);
                                                fig.parentNode.removeChild(fig);
                                                bd = changepos(x0_coord,y0_coord,x_coord,y_coord,bd);
                                                id_place = changepos(x0_coord,y0_coord,x_coord,y_coord,id_place);
                                                id_place[x0_coord][y0_coord] = 0;
                                                bd[x0_coord][y0_coord] = 0;
                                                moveTo(e)
                                            }else{
                                                elements[i].style.left = first_coorx;
                                                elements[i].style.top = first_coory;
                                            }
                                        
                                        }else if (bd[x0_coord][y0_coord] % 6 == 5){
                                            //проверяем может ли эту фигуру съесть ферзь
                                            console.log('ферзь');
                                            if ((is_figure_on_line(x_coord,y_coord,x0_coord,y0_coord,bd)) == true){
                                                //съедаем фигуру и занимаем ее место
                                                var id_down_fig = id_place[x_coord][y_coord];
                                                fig = document.getElementById(id_down_fig);
                                                fig.parentNode.removeChild(fig);
                                                bd = changepos(x0_coord,y0_coord,x_coord,y_coord,bd);
                                                id_place = changepos(x0_coord,y0_coord,x_coord,y_coord,id_place);
                                                id_place[x0_coord][y0_coord] = 0;
                                                bd[x0_coord][y0_coord] = 0;
                                                moveTo(e)
                                            }else{
                                                console.log('tut2');
                                                elements[i].style.left = first_coorx;
                                                elements[i].style.top = first_coory;
                                            }
                                        
                                        }else if(bd[x0_coord][y0_coord] % 6 == 0) {//Короли
                                            //хмм
                                            console.log('король');
                                            //съедаем фигуру если она другого цвета и занимаем ее место
                                            var id_down_fig = id_place[x_coord][y_coord];
                                            fig = document.getElementById(id_down_fig);
                                            fig.parentNode.removeChild(fig);
                                            bd = changepos(x0_coord,y0_coord,x_coord,y_coord,bd);
                                            id_place = changepos(x0_coord,y0_coord,x_coord,y_coord,id_place);
                                            id_place[x0_coord][y0_coord] = 0;
                                            bd[x0_coord][y0_coord] = 0;
                                            moveTo(e)
                                        }else if(bd[x0_coord][y0_coord] % 6 == 1) {//Пешка
                                            //стоит ли между пешкой и фигурой другая фигура
                                            if ((y0_coord != y_coord)&&(steps[x_coord][y_coord] == 1)){
                                                console.log('пешка');
                                                //съедаем фигуру если она другого цвета и занимаем ее место
                                                var id_down_fig = id_place[x_coord][y_coord];
                                                fig = document.getElementById(id_down_fig);
                                                fig.parentNode.removeChild(fig);
                                                bd = changepos(x0_coord,y0_coord,x_coord,y_coord,bd);
                                                id_place = changepos(x0_coord,y0_coord,x_coord,y_coord,id_place);
                                                id_place[x0_coord][y0_coord] = 0;
                                                bd[x0_coord][y0_coord] = 0;
                                                moveTo(e)
                                            }else{
                                                console.log('tut1');
                                                elements[i].style.left = first_coorx;
                                                elements[i].style.top = first_coory;
                                            }
                                                
                                        }else if (bd[x0_coord][y0_coord] % 6 == 3){//это конь
                                            console.log('конь');
                                            var id_down_fig = id_place[x_coord][y_coord];
                                            fig = document.getElementById(id_down_fig);
                                            fig.parentNode.removeChild(fig);
                                            bd = changepos(x0_coord,y0_coord,x_coord,y_coord,bd);
                                            id_place = changepos(x0_coord,y0_coord,x_coord,y_coord,id_place);
                                            id_place[x0_coord][y0_coord] = 0;
                                            bd[x0_coord][y0_coord] = 0;
                                            moveTo(e)
                                        }
                                        
                                        

                                        
                                    }else{
                                        console.log('prikol');
                                        elements[i].style.left = first_coorx;
                                        elements[i].style.top = first_coory;
                                    }
                                }else{
                                    console.log('prikol');
                                    elements[i].style.left = first_coorx;
                                    elements[i].style.top = first_coory;
                                }
                                
    
                            }
                        }
                        }
                    elements[i].ondragstart = function() {
                        return false;
                    }  
    
                }
    
            </script></p>

</body>
</html>